<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>野菜表示一覧</title>
  <style>
    body {
      font-family: "Arial", sans-serif;
      background-color: #f0fff0;
      padding: 20px;
    }
    h1 {
      color: #2e8b57;
    }
    .recommend-box {
      background-color: #ffe;
      border: 2px solid #ffb;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 30px;
      box-shadow: 0 0 10px rgba(255, 200, 100, 0.5);
    }
    .recommend-box h2 {
      color: #d2691e;
      margin-top: 0;
    }
    .recommend-items {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .veggie-box {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 10px;
    }
    .recommend {
      border: 2px solid #d0e0d0;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
      font-size: 1.1em;
      background-color: #ddd;
      transition: background-color 0.3s ease;
    }
    .low {
      background-color: #ddd;
    }
    .mid {
      background-color: #ffe0b2;
    }
    .high {
      background-color: #c8f7c5;
    }
    .emoji {
      font-size: 2em;
    }
    .recommend img {
      max-width: 100px;
      max-height: 100px;
      border-radius: 10px;
      object-fit: cover;
      margin-bottom: 8px;
    }
    .info {
      margin-top: 5px;
      font-size: 0.95em;
      color: #333;
    }
    .recommend strong,
    .recommend .emoji {
      white-space: nowrap;
    }
    .info-wrap {
      white-space: nowrap;
    }
    .recommend-items,
    .veggie-box {
      display: grid;
      grid-template-columns: repeat(auto-fit, 170px);
      justify-content: center;
      gap: 20px;
    }
    .recommend {
      width: 170px;
      box-sizing: border-box;
    } 



    @media (max-width: 400px) {
      .recommend-items,
      .veggie-box {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* ← 2列ぴったり */
        justify-content: center;
        gap: 20px;
      }
      .recommend {
        grid-template-columns: repeat(2, 1fr); /* ← 2列ぴったり */
        justify-content: center;
      }
    }
  </style>

</head>

<body>
  <h1>直売所野菜表示プロトタイプ</h1>

  <p>※実際の商品ではありません。</p>
  <p>アンケートを募集しています。アンケートは<a href="https://docs.google.com/forms/d/e/1FAIpQLSfvETfqDSDGOIo0oQibs4PrzGRt_vi6dsEzKqiPyljdj8-ttw/viewform?usp=header">こちら</a> </p>

  <div class="recommend-box">
    <h2>本日のおすすめ</h2>
    <div class="recommend-items" id="recommendBox"></div>
    <p>おすすめに選んだ商品がここに表示されるようになってます。</p>
  </div>

  <div class="veggie-box" id="veggieDisplay"></div>

  <script>
    const params = new URLSearchParams(window.location.search);

    const emojiOptions = [
      { name: "にんじん", emoji: "🥕" },
      { name: "トマト", emoji: "🍅" },
      { name: "きゅうり", emoji: "🥒" },
      { name: "キャベツ", emoji: "🥬" },
      { name: "ピーマン", emoji: "🫑" },
      { name: "レタス", emoji: "🥗" },
      { name: "たまねぎ", emoji: "🧅" },
      { name: "じゃがいも", emoji: "🥔" },
      { name: "だいこん", emoji: "🌱" },
      { name: "なす", emoji: "🍆" },
    ];

    function getCountClass(count) {
      if (count === 0) return "low";
      if (count <= 20) return "mid";
      return "high";
    }


    const veggies = [];
    let anyInput = false;

    for (let i = 1; ; i++) {
      const name = params.get(`new_name_${i}`);
      if (!name) break;
      anyInput = true;
      const count = parseInt(params.get(`new_count_${i}`) || "0", 10);
      const price = parseInt(params.get(`new_price_${i}`) || "0", 10);
      const img = params.get(`new_img_${i}`) || null;
      const emoji = params.get(`new_emoji_${i}`) || "🥦";
      const recommend = params.get(`new_recommend_${i}`) === "1";
      veggies.push({ name, count, price, img, emoji });
    }



      if (!anyInput) {
        const fixedList = emojiOptions.slice(0, 10); 
        fixedList.forEach(base => {
          const count = Math.floor(Math.random() * 100);
          const price = Math.floor(Math.random() * 131) + 70;
          veggies.push({ name: base.name, count, price, img: null, emoji: base.emoji });
        });
      }

    


      const recommended = veggies.filter(v => v.recommend);
      const fallbackRecommended = veggies.slice(0, 3);
      const displayVeggies = veggies.slice(0, 10);


    function createVeggieDiv(veggie) {
      const div = document.createElement("div");
      div.className = "recommend " + getCountClass(veggie.count);

      let imgHTML = "";
      if (veggie.img) {
        imgHTML = `<img src="${veggie.img}" alt="${veggie.name}の画像">`;
      } else {
        imgHTML = `<div class="emoji">${veggie.emoji || "🥦"}</div>`;
      }

      div.innerHTML = `
        ${imgHTML}
        <strong>${veggie.name}</strong><br>
        <div class="info">個数：${veggie.count} 個</div>
        <div class="info">単価：${veggie.price} 円</div>
      `;
      return div;
    }

    const recommendBox = document.getElementById("recommendBox");
    (recommended.length ? recommended : fallbackRecommended).forEach(v => {
      recommendBox.appendChild(createVeggieDiv(v));
    });


    const container = document.getElementById("veggieDisplay");
    displayVeggies.forEach(v => {
      container.appendChild(createVeggieDiv(v));
    });


  </script>
  <p>在庫が少なくなったものはオレンジで、無くなったものは灰色で表示されます。</p>
</body>
</html>
